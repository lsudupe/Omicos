---
title: "Datos ómicos unidad 1"
author: "Laura Sudupe Medinilla"
date: "27/2/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

```



# EXERCISE 1. expressionSet vignette

- Get the ExpressionSet vignette
- Create of an expressionSet from scratch
- Practice access and modification of slot contents, expeacially using exprs() 
and pData()


The definition of the **ExpressionSet** class along with many methods for 
manipulating **ExpressionSet** objets are defined in the *Biobase* package.
```{r}
#install.packages("BiocManager")
#BiocManager::install("Biobase")
library("Biobase")
```


The data from many high-throughput genomic experiments, such as microarray 
experiments, usually consist of several conceptually distinct parts: assay data, 
phenotypic meta-data, feature annotations and meta-data, and a description of 
the experiment. We´ll construct each of these components, and then assemble them 
into an **ExpressionSet**.

## Assay data

Matrix of "expression" values from the experiment. The values usually derived 
from microarrays of one sort or another, perphaps after initial processing by 
manufactuer software or Bioconductor packages.

The matrix has F rows and S columns, where *F* is the number of features on the 
chip and *S* is the number of samples.

```{r}
dataDirectory <- system.file("extdata", package="Biobase")
exprsFile <- file.path(dataDirectory, "exprsData.txt")

#These first two lines create a file path pointing to where the assay data is 
#stored

exprs <- as.matrix(read.table(exprsFile, header=TRUE, sep="\t",
                              row.names=1,
                              as.is=TRUE))
```

Lets verify that the data have read matches your expectations. At minimun, check
the class and dimensions of **geneData** and take a peak at the first several 
rows

```{r}
class(exprs)
```
```{r}
dim(exprs)
```
```{r}
colnames(exprs)
```
```{r}
head(exprs[,1:5])
```
We create a minimal *ExpressionSet* object using the **ExpressionSet** 
constructor:

```{r}
minimalSet <- ExpressionSet(assayData = exprs)
```


## Phenotypic data

Phenotypic data summarizes information about samples (sex, age, and treatment 
status;refererd to as "covariates"). The information describing the samples can 
be represented as a table with *S* rows and *V* columns, where *v* is the number
of covariates.

```{r}
pDataFile <- file.path(dataDirectory, "pData.txt")
pData <- read.table(pDataFile, 
                    row.names=1,
                    header=TRUE,
                    sep="\t")
                    
dim(pData)
```
```{r}
rownames(pData)
summary(pData)
```
Note thar the number of rows of phenotypic data amtch the number of columns of 
expression data, and indeed that the row and columns names are identically ordered.
```{r}
all(rownames(pData)==colnames(exprs))
```
Phenotypic data can take a lot of different forms. Some covariates might be
represented as numeric values. Others (gender, tissue type, cancer status) might
better be represented as **factor** objets. It is especially important that the
phenotypic data are encoded correctly.

```{r}
#We can deermine the classes of each column with sapply
sapply(pData, class)
```
What is the sex and Case/Control status of the 15th and 20th samples? And for 
the sample(s) with score greater than 0.8.
```{r}
pData[c(15,20), c("gender", "type")]
pData[pData$score>0.8,]
```
When the column names doesn´t provide enough information about the covariate
we can create a dataframe containing such meta-data, or read the information from
a file using read.table
```{r}
metadata <- data.frame(labelDescription=
                         c("Patient gender",
                           "Case/control status",
                           "Tumor progress on XYZ scale"),
                       row.names = c("gender", "type", "score"))
```

Bioconductor´s **Biobase** package provides a class called *AnnotatedDataFrame**
that conveniently stores and manipulates the phenotypic data and its metadata in 
a coordinated fashion
```{r}
phenoData <- new("AnnotatedDataFrame", 
                 data=pData, varMetadata=metadata)
```

This *AnnotatedDataFrame* objects can be subset much like a *dataframe*
```{r}
head(pData(phenoData))
phenoData[c("A", "Z"), "gender"]
```

## Annotations and feature data





# EXERCISE 2. GEOquery package

- Install and load the GEOquery package
  - Browse te GEPquery vignette
- Create an ExpressionSet by downloading a dataset from GEO
- Investigate the structure of the object
- Find out how you can access and change
  - The expression values or
    - the covariates in the phenoData

